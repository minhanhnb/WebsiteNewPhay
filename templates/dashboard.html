{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/system_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="system-container">
    
   <div class="d-flex justify-content-between align-items-center mb-4 pt-4">
    <div>
        <h3 class="fw-bold m-0 text-dark">Tổng quan hệ thống</h3>
    </div>
    
    <div>
        <button class="btn-minimal btn-reset" id="btnResetData">
            <i class="fas fa-trash-alt me-2"></i>RESET DATA
        </button>
    </div>
   </div>
           <hr class="my-2 opacity-0 ">


<div class="control-panel-wrapper">
    
    <div class="panel-left">
        <div>
            <label class="control-label  d-block">Ngày thực hiện lệnh</label>
            <input type="date" id="settleDate" class="form-control-compact w-100 py-2">
        </div>
        <div class="mb-3 border-bottom pb-3">
        <label class="control-label d-block text-primary fw-bold">Ngày xem hệ thống</label>
        <input type="date" id="viewDate" class="form-control-compact w-100 py-2 fw-bold" style="background-color: #f8f9fa;">
        <small class="text-muted" style="font-size: 0.75rem;">*Thay đổi để xem giá trị tài sản theo ngày</small>
        </div>
    
                <button class="btn-minimal btn-outline-primary-minimal justify-content-center py-2 shadow-sm" id="btnAllocate">
                    <i class="fas fa-magic me-2"></i> Phân bổ CD (Core TVAM)
                </button>
                
                <button class="btn-minimal btn-outline-primary-minimal justify-content-center py-2 shadow-sm" id="btnSyncBank">
                    <i class="fas fa-sync me-2"></i> Gửi lệnh Lưu ký (NHLK)
                </button>


    </div>

    <div class="panel-right">
        <div class="queue-header">
            <div class="fw-bold text-muted small text-uppercase">
                <i class="fas fa-list-alt me-2"></i>Hàng chờ xử lý (Settlement Queue)
            </div>
            <span class="badge bg-secondary" id="queueCount">0 lệnh</span>
        </div>
        
        <div class="queue-list" id="queueContainer">
            <div class="text-center text-muted mt-4 small">
                <i class="fas fa-check-circle me-1"></i> Không có lệnh chờ
            </div>
        </div>
    </div>
</div>
    </div>
    <div class="nav-tabs-minimal">
        <div class="tab-link active" onclick="switchTab('all', this)">Tất cả</div>
        <div class="tab-link" onclick="switchTab('user', this)">Ví Khách Hàng</div>
        <div class="tab-link" onclick="switchTab('system', this)">Core TVAM</div>
        <div class="tab-link" onclick="switchTab('bank', this)">Ngân Hàng LK</div>
    </div>


    <div id="content-area">
        
        <div id="section-user" class="section-wrapper">
            <h6 class="text-uppercase text-primary fw-bold"><i class="fas fa-wallet me-2"></i>1. Ví Khách Hàng (User)</h6>
            <div class="dashboard-grid" id="user-data-container"></div>
            <div class="card shadow-sm border-0 mb-4" style="border-radius: 12px; overflow: hidden;">
            <div class="card-body p-3 text-center">
                <h6 class="text-secondary text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px;">
                    Tiền lời hôm nay
                </h6>

                <div class="d-flex justify-content-center align-items-center mt-2">
                    <h2 id="pnl-value" class="display-6 fw-bold mb-0">--</h2>
                </div>

            </div>
            
            <div id="pnl-bar" style="height: 4px; width: 100%; background-color: #e9ecef;"></div>
        </div>
        </div>

        <div id="section-system" class="section-wrapper">
            <h6 class="text-uppercase text-danger fw-bold"><i class="fas fa-university me-2"></i>2. Core TVAM</h6>
            <div class="dashboard-grid" id="finsight-data-container"></div>
        </div>

        <div id="section-bank" class="section-wrapper">
            <h6 class="text-uppercase text-success fw-bold"><i class="fas fa-landmark me-2"></i>3. Ngân Hàng Lưu Ký</h6>
            <div class="dashboard-grid" id="bank-data-container"></div>
        </div>

    </div>
</div>

<div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div class="spinner-border text-dark spinner-border-sm me-2"></div>
    <span class="fw-bold text-dark">Đang tải...</span>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/system_dashboard.js') }}"></script>

{% endblock %}