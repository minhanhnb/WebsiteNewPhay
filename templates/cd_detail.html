{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cd_detail.css') }}">
<style>
   .chart-container {
        position: relative; height: 400px; width: 100%; margin-top: 20px;
    }
    .control-panel {
        background: #f1f3f5; padding: 20px; border-radius: 12px;
        display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;
    }
    .control-group {
        display: flex; flex-direction: column;
    }
    .control-group label {
        font-weight: 600; margin-bottom: 5px; font-size: 0.9rem;
    }
    .form-control {
        padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 1rem;
    }
    .price-display {
        margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
    }
    .price-box {
        background: #fff; padding: 15px; border-radius: 8px; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 5px solid #ccc;
    }
    .price-box h4 { margin: 0 0 5px 0; font-size: 0.9rem; color: #666; }
    .price-value { font-size: 1.4rem; font-weight: bold; color: #333; }
    .color-yield { border-color: rgb(255, 99, 132); }
    .color-custom { border-color: rgb(54, 162, 235); }
</style>
{% endblock %}
{% block body_attrs %} data-ma="{{ maDoiChieu }}" {% endblock %}

{% block content %}
<div class="detail-container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Chi ti·∫øt CD ‚Äì {{ maDoiChieu }}</h2>
        <button id="btnOpenEdit" style="background-color: #ffc107; border: none; padding: 8px 16px; cursor: pointer; border-radius: 4px; font-weight: bold;">
            ‚úèÔ∏è S·ª≠a th√¥ng tin
        </button>
    </div>

    <div class="card">
        <h3>M√¥ ph·ªèng gi√° tr·ªã</h3>
        
        <div class="control-panel">
            <div class="control-group">
                <label>Ng√†y b√°n d·ª± ki·∫øn (M/D/Y)</label>
                <input type="date" id="simulationDate" class="form-control">
            </div>

            <div class="control-group">
                <label>L√£i su·∫•t cam k·∫øt v·ªõi user (%/nƒÉm):</label>
                <input type="number" id="userInterestRate" class="form-control" step="0.1">
            </div>
            
            <div class="control-group" style="justify-content: center;">
                <button id="btnReset" style="padding: 8px 16px; cursor:pointer;">V·ªÅ h√¥m nay</button>
            </div>
        </div>

        <div class="price-display">
            <div class="price-box color-yield">
                <h4>Gi√° theo Yield</h4>
                <div id="displayPriceYield" class="price-value">Loading...</div>
            </div>
            <div class="price-box color-custom">
                <h4>Gi√° theo Yield + Kho·∫£ng X</h4>
                <div id="displayPriceCustom" class="price-value">Loading...</div>
            </div>
            <div class="price-box color-market-value">
                <h4>Market Value</h4>
                <div id="displayMarketValue" class="price-value">Loading...</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
    </div>
    <!-- <div class="card simulation-card" style="margin-top: 25px; border-top: 4px solid #6c5ce7;">
    <h3>üìä So s√°nh K·ªãch b·∫£n L√£i su·∫•t (Test Case)</h3>
    
    <div class="simulation-controls">
        <div class="sim-group">
            <label>L√£i su·∫•t Hi·ªán t·∫°i (A):</label>
            <input type="text" id="simRateCurrent" class="form-control" readonly disabled style="background: #e9ecef;">
        </div>
        <div class="sim-group">
            <label>L√£i su·∫•t M·ªõi / Gi·∫£ ƒë·ªãnh (B):</label>
            <input type="number" id="simRateNew" class="form-control" step="0.1" placeholder="Nh·∫≠p %...">
        </div>
        <div class="sim-group">
             <button id="btnRunTest" class="btn-primary">Ch·∫°y Test</button>
        </div>
    </div>

    <div class="table-responsive" style="margin-top: 15px;">
        <table class="table-comparison">
            <thead>
                <tr>
                    <th>Lo·∫°i gi√°</th>
                    <th>Gi√° theo LS Hi·ªán t·∫°i (A)</th>
                    <th>Gi√° theo LS Gi·∫£ ƒë·ªãnh (B)</th>
                    <th>Ch√™nh l·ªách (Delta)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Gi√° Yield (Market)</strong></td>
                    <td id="tdYieldA">---</td>
                    <td id="tdYieldB">---</td>
                    <td id="tdYieldDiff">---</td>
                </tr>
                <tr>
                    <td><strong>Gi√° C√¥ng th·ª©c Ri√™ng</strong></td>
                    <td id="tdCustomA">---</td>
                    <td id="tdCustomB">---</td>
                    <td id="tdCustomDiff">---</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div style="margin-top: 10px; text-align: right;">
        <small><i>* S·ªë li·ªáu t√≠nh to√°n d·ª±a tr√™n Ng√†y ƒë∆∞·ª£c ch·ªçn ·ªü tr√™n.</i></small>
        <button id="btnApplyRate" style="display:none; margin-left: 10px; background: #2ecc71; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
            √Åp d·ª•ng L√£i su·∫•t m·ªõi n√†y
        </button>
    </div>
</div> -->
    <div id="cd-info">

        <!-- Th√¥ng tin chung -->
        <div class="card">
            <h3>Th√¥ng tin chung</h3>
            <div class="row">
                <div><strong>M√£ ƒë·ªëi chi·∫øu:</strong> <span id="maDoiChieu"></span></div>
                <div><strong>T·ªï ch·ª©c ph√°t h√†nh:</strong> <span id="TCPH"></span></div>
                <div><strong>Ng√†y ph√°t h√†nh:</strong> <span id="ngayPhatHanh"></span></div>
                <div><strong>Ng√†y ƒë√°o h·∫°n:</strong> <span id="ngayDaoHan"></span></div>
                <div><strong>M·ªánh gi√°:</strong> <span id="menhGia"></span></div>
                <div><strong>S·ªë l∆∞·ª£ng:</strong> <span id="soLuong"></span></div>
                <div><strong>CD kh·∫£ d·ª•ng:</strong> <span id="CDKhaDung"></span></div>

                <!-- 3 tr∆∞·ªùng b·ªï sung -->
                <div><strong>Ng√†y th·ª±c hi·ªán quy·ªÅn:</strong> <span id="ngayTHQuyen"></span></div>
                <div><strong>Lo·∫°i l√£i su·∫•t:</strong> <span id="loaiLaiSuat"></span></div>
                <div><strong>Ghi ch√∫:</strong> <span id="ghiChu"></span></div>
            </div>
        </div>

        <!-- Th√¥ng tin l√£i su·∫•t -->
        <div class="card">
            <h3>Th√¥ng tin l√£i su·∫•t</h3>
            <div class="row">
                <div><strong>L√£i su·∫•t:</strong> <span id="laiSuat"></span></div>
                <div><strong>Quy ∆∞·ªõc ng√†y:</strong> <span id="quyUocNgay"></span></div>
                <div><strong>T·∫ßn su·∫•t tr·∫£ l√£i:</strong> <span id="tanSuatTraLai"></span></div>
            </div>
        </div>

        <!-- Th√¥ng tin nh·∫≠p kho -->
        <div class="card">
            <h3>Th√¥ng tin nh·∫≠p kho</h3>
            <div class="row">
                <div><strong>Dirty Price:</strong> <span id="dirtyPrice"></span></div>
                <div><strong>Clean Price:</strong> <span id="cleanPrice"></span></div>
                <div><strong>Ng√†y th·ª±c hi·ªán:</strong> <span id="ngayThucHien"></span></div>
                <div><strong>Ng√†y th·ª±c t·∫ø:</strong> <span id="ngayThucTe"></span></div>
                <div><strong>S·ªë l∆∞·ª£ng nh·∫≠p kho:</strong> <span id="soLuongNhapKho"></span></div>
            </div>
        </div>

        <!-- Th√¥ng tin gi√° b√°n -->
        <!-- <div class="card">
            <h3>Th√¥ng tin gi√°</h3>
            <div class="row">
                <div><strong>Accrued Interest (AI):</strong> <span id="AI"></span></div>
                <div><strong>Market Value TKO:</strong> <span id="marketValueTKO"></span></div>
                <div><strong>Gi√° b√°n h√¥m nay:</strong> <span id="giaBanHomNay"></span></div>
            </div>
        </div> -->

    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/cd_detail.js') }}"></script>
{% endblock %}